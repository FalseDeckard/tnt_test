# Search Engine Project

Проект представляет собой поисковый движок с поддержкой различных методов поиска: векторного, текстового (BM25) и гибридного. Система разработана для эффективного поиска по русскоязычным документам с учетом семантики и точного соответствия.

## Архитектура

Проект реализован как веб-приложение на FastAPI с тремя основными методами поиска:
- Векторный поиск (semantic search)
- Текстовый поиск (BM25)
- Гибридный поиск (комбинация векторного и текстового)

### Структура проекта
```
tnt_test/
├── app/
│   ├── api/               # API endpoints
│   ├── core/             # Поисковые движки
│   ├── models/           # Pydantic модели
│   ├── templates/        # HTML шаблоны
│   └── evaluation/       # Модули оценки качества
├── data/
│   ├── processed/        # Обработанные данные
│   └── evaluation/       # Данные для оценки
└── README.md
```

## Реализация поисковых методов

### 1. Векторный поиск

#### Выбор модели
Для векторного поиска используется SOTA-модель `deepvk/USER-bge-m3`. Выбор обоснован следующими факторами:

1. **Специализация на русском языке**: Выбран 
2. **Хорошие результаты сразу в ряде бенчмарков**: Оптимальный баланс между качеством и производительностью
3. **Семантическая точность**: Высокие результаты на бенчмарках для русского языка
4. **Эффективность**: Быстрая генерация эмбеддингов благодаря оптимизированной архитектуре

#### Реализация
- Использование FAISS для индексации и поиска
- Нормализация векторов для косинусного сходства
- Поддержка батчей для оптимизации производительности
- Кэширование модели для экономии памяти

### 2. Текстовый поиск (BM25)

#### Особенности реализации
- Использование BM25Okapi с оптимизированными параметрами
- Предварительная обработка текста:
  - Лемматизация с помощью pymorphy3
  - Удаление стоп-слов
  - Нормализация текста
- Кэширование обработанных запросов

### 3. Гибридный поиск

#### Алгоритм объединения результатов
1. **Взвешенное объединение**:
   ```python
   final_score = bm25_score * weight_bm25 + vector_score * weight_vector
   ```
   где веса настраиваются динамически (по умолчанию 0.5/0.5)

2. **Нормализация скоров**:
   - BM25 скоры нормализуются к диапазону [0, 1]
   - Векторные скоры уже нормализованы (косинусное сходство)

3. **Ранжирование**:
   - Результаты сортируются по комбинированному скору
   - Возвращаются top-k документов
   
## Датасет

### Общая информация
- Количество документов: 6793
- Тип данных: Новостные статьи на русском языке
- Временной период: 2023-2024
- Средняя длина документа: ~2500 символов

### Структура данных
Каждый документ содержит следующие поля:
```json
{
    "title": "Заголовок статьи",
    "summary": "Краткое содержание статьи",
    "url": "URL источника",
    "date": "Дата публикации",
    "text": "Полный текст статьи",
    "text_processed": "Предобработанный текст для поиска"
}
```

### Предобработка данных

1. **Текстовая предобработка**:
   - Лемматизация с помощью pymorphy3
   - Удаление стоп-слов
   - Нормализация текста (приведение к нижнему регистру, удаление спецсимволов)

2. **Подготовка данных**:
   - Создание FAISS индекса для векторного поиска
   - Генерация и сохранение эмбеддингов
   - Подготовка документов для BM25

## API и Интерфейс

### REST API
- POST `/api/search/`: Основной эндпоинт поиска
- Поддержка множественных запросов
- Настройка весов для гибридного поиска
- Пакетная обработка запросов

### Веб-интерфейс
- Интуитивный интерфейс для тестирования
- Настройка параметров поиска
- Визуализация результатов и метрик

## Оценка качества

### Метрики
- Precision@k
- Recall@k
- nDCG@k
- Время выполнения

### Результаты тестирования
(здесь будут результаты после проведения оценки)

## Особенности и ограничения

1. **Производительность**:
   - Кэширование модели и эмбеддингов
   - Пакетная обработка запросов
   - Оптимизация использования памяти

2. **Ограничения**:
   - Максимальное количество запросов в батче: 20
   - Максимальное количество возвращаемых результатов: 20

## Установка и запуск

### Через Docker

1. Убедитесь, что у вас установлен Docker

2. Создайте образ:
```bash
docker build -t search-engine .
```

3. Запустите контейнер:
```bash
docker run -p 8000:8000 search-engine
```

После запуска:
- Веб-интерфейс будет доступен по адресу: http://localhost:8000
- API документация: http://localhost:8000/api/docs
- Альтернативная документация: http://localhost:8000/api/redoc

### Структура Docker образа

- Базовый образ: `python:3.10-slim`
- Предустановленные компоненты:
  - Все необходимые Python пакеты из requirements.txt
  - Модель deepvk/USER-bge-m3 для векторного поиска
  - Необходимые данные загружаются при старте через скрипт download_data.sh

### Примечания по развертыванию

- Порт 8000 должен быть свободен на хост-машине
- При первом запуске будет загружена модель (~1.5GB) и необходимые данные
- Для сохранения данных между запусками можно использовать Docker volumes:
```bash
docker run -p 8000:8000 -v /path/to/data:/app/data search-engine
```


## Дальнейшие улучшения

1. Оптимизация батч-процессинга для векторного поиска
2. Реализация более сложных алгоритмов объединения результатов
3. User interface